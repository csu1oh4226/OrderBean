# Green 단계 구현 우선순위

**작성일**: 2025-12-15  
**현재 상태**: 구현 완료, 테스트 환경 설정 필요

---

## 🎯 우선순위 개요

Green 단계를 완료하기 위해 다음 순서로 진행하는 것을 권장합니다.

### 우선순위 레벨

- 🔴 **Critical (필수)**: 테스트 통과를 위해 반드시 필요
- 🟡 **High (높음)**: 대부분의 테스트 통과에 필요
- 🟢 **Medium (중간)**: 일부 테스트 통과에 필요
- ⚪ **Low (낮음)**: 선택적 개선 사항

---

## 🔴 Critical Priority (필수 - 즉시 해결)

### 1. 데이터베이스 환경 설정

**우선순위**: 🔴 Critical  
**예상 시간**: 30분  
**영향**: 모든 테스트 (39개)

#### 작업 내용
- [ ] PostgreSQL 서비스 실행 확인
- [ ] 테스트용 데이터베이스 생성 (`orderbean_test`)
- [ ] 데이터베이스 마이그레이션 실행
- [ ] 환경 변수 설정 (`.env.test`)

#### 실행 명령어
```bash
# 1. PostgreSQL 실행 확인
pg_isready

# 2. 테스트용 데이터베이스 생성
createdb orderbean_test

# 3. 마이그레이션 실행
cd backend
npm run migrate

# 4. 환경 변수 설정
# backend/.env.test 파일 생성
DATABASE_URL=postgresql://orderbean:orderbean@localhost:5432/orderbean_test
```

#### 예상 효과
- ✅ 31개 테스트의 데이터베이스 연결 문제 해결
- ✅ 실제 데이터베이스 쿼리 테스트 가능

---

### 2. 테스트 데이터 준비

**우선순위**: 🔴 Critical  
**예상 시간**: 1시간  
**영향**: 매장/주문/관리자 테스트 (29개)

#### 작업 내용
- [ ] 테스트용 매장 데이터 생성
- [ ] 테스트용 메뉴 데이터 생성
- [ ] 테스트용 사용자 데이터 (선택)
- [ ] 시드 스크립트 작성

#### 필요한 데이터
```typescript
// 최소 필요 데이터
- Store: 2-3개 (위치 정보 포함)
- Menu: 각 매장당 3-5개
- User: 테스트용 사용자 (선택)
```

#### 예상 효과
- ✅ 매장 조회 테스트 통과
- ✅ 메뉴 조회 테스트 통과
- ✅ 주문 생성 테스트 통과

---

## 🟡 High Priority (높음 - 우선 구현)

### 3. 인증 미들웨어 테스트 통합

**우선순위**: 🟡 High  
**예상 시간**: 30분  
**영향**: 인증 관련 테스트 (6개)

#### 작업 내용
- [ ] 테스트에서 실제 인증 미들웨어 사용
- [ ] JWT 토큰 생성/검증 테스트
- [ ] 인증 실패 케이스 테스트

#### 현재 상태
- ✅ 인증 미들웨어 구현 완료
- ⚠️ 테스트에서 모킹 사용 중
- ⚠️ 실제 토큰 검증 테스트 필요

---

### 4. 에러 응답 형식 통일

**우선순위**: 🟡 High  
**예상 시간**: 1시간  
**영향**: 에러 처리 테스트 (15개)

#### 작업 내용
- [ ] 모든 에러 응답에 `message` 필드 포함 확인
- [ ] Zod 에러 메시지 포맷 통일
- [ ] HTTP 상태 코드 일관성 확인

#### 현재 문제
- 일부 에러 응답이 빈 객체 `{}` 반환
- Zod 에러가 제대로 처리되지 않음

#### 수정 필요 파일
- `backend/src/middleware/errorHandler.ts` (일부 수정 완료)
- 각 컨트롤러의 에러 처리

---

### 5. 주문 생성 로직 검증

**우선순위**: 🟡 High  
**예상 시간**: 2시간  
**영향**: 주문 API 테스트 (12개)

#### 작업 내용
- [ ] 픽업 시간 검증 로직 확인
- [ ] 품절 메뉴 검증 로직 확인
- [ ] 시간대별 주문 제한 로직 확인
- [ ] 트랜잭션 처리 확인

#### 현재 상태
- ✅ 기본 로직 구현 완료
- ⚠️ 테스트 데이터 의존성 확인 필요
- ⚠️ 에러 메시지 형식 확인 필요

---

## 🟢 Medium Priority (중간)

### 6. 매장 위치 기반 조회 개선

**우선순위**: 🟢 Medium  
**예상 시간**: 1시간  
**영향**: 매장 API 테스트 (3개)

#### 작업 내용
- [ ] Haversine 공식으로 정확한 거리 계산
- [ ] 위치 파라미터 검증 강화
- [ ] 빈 매장 목록 처리

#### 현재 상태
- ✅ 기본 구현 완료
- ⚠️ 거리 계산 로직 단순화됨
- ⚠️ 실제 위치 기반 쿼리 필요

---

### 7. 페이지네이션 검증

**우선순위**: 🟢 Medium  
**예상 시간**: 30분  
**영향**: 목록 조회 테스트 (3개)

#### 작업 내용
- [ ] 페이지네이션 응답 형식 확인
- [ ] 빈 목록 처리
- [ ] 페이지 범위 검증

---

### 8. 대시보드 통계 로직 검증

**우선순위**: 🟢 Medium  
**예상 시간**: 1시간  
**영향**: 관리자 대시보드 테스트 (3개)

#### 작업 내용
- [ ] 통계 계산 로직 확인
- [ ] 피크 시간 분석 로직 확인
- [ ] 날짜 범위 필터링 확인

---

## ⚪ Low Priority (낮음 - 선택적)

### 9. 성능 최적화

**우선순위**: ⚪ Low  
**예상 시간**: 2-3시간

#### 작업 내용
- [ ] 데이터베이스 쿼리 최적화
- [ ] 인덱스 추가
- [ ] 캐싱 전략

---

### 10. 추가 검증 로직

**우선순위**: ⚪ Low  
**예상 시간**: 1-2시간

#### 작업 내용
- [ ] 비즈니스 규칙 검증 강화
- [ ] 엣지 케이스 처리
- [ ] 입력 데이터 정규화

---

## 📊 우선순위별 예상 효과

### Critical 완료 시
- **통과 예상**: 35-38개 테스트
- **실패 예상**: 1-4개 테스트
- **커버리지**: 80%+ 달성 가능

### High 완료 시
- **통과 예상**: 38-39개 테스트
- **실패 예상**: 0-1개 테스트
- **커버리지**: 85%+ 달성 가능

### Medium 완료 시
- **통과 예상**: 39개 테스트 (100%)
- **커버리지**: 90%+ 달성 가능

---

## 🎯 권장 진행 순서

### Phase 1: Critical (1-2일)
1. ✅ 데이터베이스 환경 설정
2. ✅ 테스트 데이터 준비
3. ✅ 기본 테스트 실행 및 확인

### Phase 2: High (1일)
4. ✅ 인증 미들웨어 테스트 통합
5. ✅ 에러 응답 형식 통일
6. ✅ 주문 생성 로직 검증

### Phase 3: Medium (1일)
7. ✅ 매장 위치 기반 조회 개선
8. ✅ 페이지네이션 검증
9. ✅ 대시보드 통계 로직 검증

### Phase 4: Low (선택)
10. ✅ 성능 최적화
11. ✅ 추가 검증 로직

---

## 📝 체크리스트

### Critical (필수)
- [ ] PostgreSQL 실행 및 데이터베이스 생성
- [ ] Prisma 마이그레이션 실행
- [ ] 테스트용 데이터 시드
- [ ] 환경 변수 설정

### High (높음)
- [ ] 인증 테스트 통과 확인
- [ ] 에러 응답 형식 통일
- [ ] 주문 생성 로직 검증

### Medium (중간)
- [ ] 매장 조회 로직 개선
- [ ] 페이지네이션 검증
- [ ] 대시보드 로직 검증

---

## 💡 빠른 시작 가이드

### 1단계: 데이터베이스 설정 (30분)

```bash
# PostgreSQL 실행 확인
pg_isready

# 테스트용 데이터베이스 생성
createdb orderbean_test

# 마이그레이션 실행
cd backend
npm run migrate
```

### 2단계: 테스트 데이터 생성 (1시간)

```bash
# 시드 스크립트 실행 (작성 필요)
npm run seed:test
```

### 3단계: 테스트 실행 (5분)

```bash
npm test
```

---

## 📈 진행 상황 추적

### 현재 완료율
- **Critical**: 0% (0/2)
- **High**: 0% (0/3)
- **Medium**: 0% (0/3)
- **Low**: 0% (0/2)

### 목표
- **1주일 내**: Critical + High 완료
- **2주일 내**: Medium 완료
- **선택적**: Low 완료

---

## 🔗 관련 문서

- [GREEN_PHASE_GUIDE.md](../docs/GREEN_PHASE_GUIDE.md) - 상세 구현 가이드
- [GREEN_PHASE_CHECKLIST.md](../docs/GREEN_PHASE_CHECKLIST.md) - 체크리스트
- [GREEN_PHASE_TEST_RESULTS.md](./GREEN_PHASE_TEST_RESULTS.md) - 테스트 결과
- [TEST_EXECUTION_GUIDE.md](./TEST_EXECUTION_GUIDE.md) - 테스트 실행 가이드

---

**작성일**: 2025-12-15  
**다음 검토**: Critical 항목 완료 후

